<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guia de Observa√ß√£o Biol√≥gica: O Alfaiate</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --brand-purple: #6b21a8;
            --brand-gold: #d97706;
            --paper-cream: #fdfbf7;
        }
        body {
            font-family: 'Lato', sans-serif;
            background-color: var(--paper-cream);
            color: #1f2937;
        }
        h1, h2, h3, .classic-font {
            font-family: 'Cinzel', serif;
        }
        
        /* Glassmorphism Header */
        .glass-nav {
            background: rgba(107, 33, 168, 0.85);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Flip Card Effects */
        .perspective-1000 { perspective: 1000px; }
        .transform-style-3d { transform-style: preserve-3d; }
        .backface-hidden { backface-visibility: hidden; }
        .rotate-y-180 { transform: rotateY(180deg); }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #c084fc; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #a855f7; }

        /* Print Styles for Certificate */
        @media print {
            body * { visibility: hidden; }
            #certificate-area, #certificate-area * { visibility: visible; }
            #certificate-area { position: absolute; left: 0; top: 0; width: 100%; height: 100%; margin: 0; padding: 0; }
            .no-print { display: none !important; }
        }

        /* Animation Utilities */
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Navigation -->
    <header class="glass-nav fixed top-0 w-full z-50 transition-all duration-300 shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center gap-2">
                    <span class="text-2xl text-white classic-font font-bold tracking-widest">O ALFAIATE</span>
                    <span class="text-purple-200 text-xs hidden sm:inline-block border border-purple-300 rounded px-2 py-0.5">Recurvirostra avosetta</span>
                </div>
                <!-- Desktop Nav -->
                <nav class="hidden md:flex space-x-4">
                    <button onclick="switchTab('study')" class="nav-btn text-purple-100 hover:text-white px-3 py-2 rounded-md text-sm font-medium transition-colors" data-tab="study">Guia de Estudo</button>
                    <button onclick="switchTab('flashcards')" class="nav-btn text-purple-100 hover:text-white px-3 py-2 rounded-md text-sm font-medium transition-colors" data-tab="flashcards">Flashcards</button>
                    <button onclick="switchTab('glossary')" class="nav-btn text-purple-100 hover:text-white px-3 py-2 rounded-md text-sm font-medium transition-colors" data-tab="glossary">Gloss√°rio</button>
                    <button onclick="switchTab('quiz')" class="nav-btn text-purple-100 hover:text-white px-3 py-2 rounded-md text-sm font-medium transition-colors" data-tab="quiz">Aprendizagem Ativa</button>
                </nav>
                <!-- Mobile Menu Button -->
                <div class="md:hidden">
                    <button onclick="toggleMobileMenu()" class="text-white hover:text-purple-200 focus:outline-none">
                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden bg-purple-900 border-t border-purple-700">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                <button onclick="switchTab('study')" class="block text-gray-300 hover:text-white px-3 py-2 rounded-md text-base font-medium w-full text-left">Guia de Estudo</button>
                <button onclick="switchTab('flashcards')" class="block text-gray-300 hover:text-white px-3 py-2 rounded-md text-base font-medium w-full text-left">Flashcards</button>
                <button onclick="switchTab('glossary')" class="block text-gray-300 hover:text-white px-3 py-2 rounded-md text-base font-medium w-full text-left">Gloss√°rio</button>
                <button onclick="switchTab('quiz')" class="block text-gray-300 hover:text-white px-3 py-2 rounded-md text-base font-medium w-full text-left">Quiz</button>
            </div>
        </div>
        <!-- Progress Bar -->
        <div class="w-full bg-purple-900 h-1">
            <div id="progress-bar" class="bg-yellow-400 h-1 transition-all duration-500" style="width: 0%"></div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow pt-20 pb-10 px-4 sm:px-6 lg:px-8 max-w-7xl mx-auto w-full">
        
        <!-- SEC√á√ÉO I: GUIA DE ESTUDO -->
        <section id="study" class="tab-content fade-in">
            <div class="text-center mb-10">
                <h2 class="text-4xl text-purple-900 mb-2 classic-font">Guia de Estudo</h2>
                <p class="text-gray-600 italic">Uma viagem pela biologia e ecologia da "Ave S√≠mbolo" do Estu√°rio do Tejo.</p>
            </div>

            <!-- Multimedia Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-12">
                <!-- Video -->
                <div class="bg-white p-3 shadow-lg rounded-lg border border-gray-200 flex flex-col">
                    <h3 class="text-lg font-bold text-purple-800 mb-3 border-b border-gray-100 pb-2">Videoteca: Asa, o Pequeno Alfaiate</h3>
                    <!-- Aspect Ratio Wrapper 4:3 (75% padding for 640x480) -->
                    <div class="relative w-full overflow-hidden rounded-md shadow-inner bg-black" style="padding-top: 75%;">
                        <iframe class="absolute top-0 left-0 w-full h-full" 
                            src="https://drive.google.com/file/d/1G46ZYP-CplFgR0qibkPXDoeIXCbFLjhC/preview" 
                            width="640" 
                            height="480" 
                            frameborder="0" 
                            allow="autoplay"
                            allowfullscreen>
                        </iframe>
                    </div>
                    <!-- Fallback link for playback errors -->
                    <div class="p-2 text-center bg-gray-50 mt-3 rounded">
                        <a href="https://drive.google.com/file/d/1G46ZYP-CplFgR0qibkPXDoeIXCbFLjhC/view" target="_blank" class="inline-flex items-center text-xs font-bold text-purple-700 hover:text-purple-900 transition-colors">
                            <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 24 24"><path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"/></svg>
                            Ver no Google Drive (Caso o v√≠deo n√£o inicie)
                        </a>
                    </div>
                </div>

                <!-- Multimedia Resources -->
                <div class="flex flex-col gap-6">
                    <!-- Infografia -->
                    <div class="bg-white p-4 shadow-md rounded-lg border-l-4 border-purple-500">
                        <div class="mb-3">
                            <h3 class="font-bold text-purple-800 flex items-center gap-2">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                                Infografia Interativa
                            </h3>
                            <p class="text-sm text-gray-600 mt-1">Explore os detalhes anat√≥micos e o ciclo de vida. <strong>Clique na imagem para ampliar.</strong></p>
                        </div>
                        
                        <!-- Visible Image Preview -->
                        <div class="relative group cursor-zoom-in rounded-lg overflow-hidden border border-gray-200 shadow-sm" onclick="openModal('infographic-modal')">
                            <img src="./infografia.jpg" 
                                 alt="Infografia cient√≠fica do Alfaiate: Anatomia, Habitat e Ciclo de Vida" 
                                 class="w-full h-auto object-cover transition-transform duration-500 group-hover:scale-105"
                                 onerror="this.onerror=null; this.parentElement.innerHTML='<div class=\'h-48 bg-gray-100 flex flex-col items-center justify-center text-gray-500 text-sm p-4 text-center\'><span class=\'text-2xl mb-2\'>üñºÔ∏è</span>Imagem (./infografia.jpg) n√£o encontrada.<br>Adicione o ficheiro √† pasta.</div>';">
                            
                            <!-- Overlay Hint -->
                            <div class="absolute inset-0 bg-purple-900 bg-opacity-0 group-hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                                <span class="bg-white text-purple-900 px-4 py-2 rounded-full font-bold text-sm shadow-lg transform translate-y-4 opacity-0 group-hover:opacity-100 group-hover:translate-y-0 transition-all duration-300">
                                    üîç Ver em Ecr√£ Inteiro
                                </span>
                            </div>
                        </div>
                    </div>

                    <!-- Podcast -->
                    <div class="bg-white p-4 shadow-md rounded-lg border-l-4 border-yellow-500">
                        <h3 class="font-bold text-purple-800 flex items-center gap-2 mb-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path></svg>
                            Podcast Educativo
                        </h3>
                        <p class="text-sm text-gray-600 mb-3">Ou√ßa a narrativa sobre a migra√ß√£o e conserva√ß√£o.</p>
                        <audio controls class="w-full h-10 rounded bg-gray-100">
                            <source src="./podcast.mp3" type="audio/mpeg">
                            O seu navegador n√£o suporta o elemento de √°udio.
                        </audio>
                    </div>
                </div>
            </div>

            <!-- Content Accordions -->
            <div id="study-content" class="space-y-4 max-w-4xl mx-auto">
                <!-- Content will be injected by JS -->
            </div>
        </section>

        <!-- SEC√á√ÉO II: FLASHCARDS -->
        <section id="flashcards" class="tab-content hidden fade-in">
            <div class="flex justify-between items-center mb-8">
                <div>
                    <h2 class="text-3xl text-purple-900 classic-font">Cart√µes de Estudo</h2>
                    <p class="text-gray-600">Memorize conceitos-chave sobre o Alfaiate.</p>
                </div>
                <div class="flex space-x-2">
                    <button onclick="setFlashcardMode('view')" class="px-4 py-2 bg-purple-600 text-white rounded shadow hover:bg-purple-700 text-sm">Modo Estudo</button>
                    <button onclick="setFlashcardMode('game')" class="px-4 py-2 bg-yellow-500 text-white rounded shadow hover:bg-yellow-600 text-sm">Jogo de Correspond√™ncia</button>
                </div>
            </div>

            <!-- Flashcard Viewer Mode -->
            <div id="fc-view-mode" class="flex flex-col items-center">
                <div class="perspective-1000 w-full max-w-lg h-80 cursor-pointer group" onclick="flipCard(this)">
                    <div id="current-flashcard" class="relative w-full h-full transition-transform duration-700 transform-style-3d shadow-xl rounded-xl">
                        <!-- Front -->
                        <div class="absolute w-full h-full bg-white border-2 border-purple-200 rounded-xl flex flex-col items-center justify-center p-8 backface-hidden">
                            <span class="text-purple-500 text-sm font-bold tracking-widest uppercase mb-4">Pergunta</span>
                            <p id="fc-front" class="text-xl md:text-2xl text-center text-gray-800 font-medium">--</p>
                            <p class="absolute bottom-4 text-xs text-gray-400">Toque para virar</p>
                        </div>
                        <!-- Back -->
                        <div class="absolute w-full h-full bg-purple-600 rounded-xl flex flex-col items-center justify-center p-8 backface-hidden rotate-y-180">
                            <span class="text-purple-200 text-sm font-bold tracking-widest uppercase mb-4">Resposta</span>
                            <p id="fc-back" class="text-xl md:text-2xl text-center text-white font-medium">--</p>
                        </div>
                    </div>
                </div>

                <div class="flex items-center space-x-8 mt-8">
                    <button onclick="prevCard()" class="p-3 rounded-full bg-white shadow-md hover:bg-gray-100 text-purple-700">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                    </button>
                    <span id="fc-counter" class="font-mono text-gray-500">1 / 30</span>
                    <button onclick="nextCard()" class="p-3 rounded-full bg-white shadow-md hover:bg-gray-100 text-purple-700">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                    </button>
                </div>
            </div>

            <!-- Flashcard Game Mode -->
            <div id="fc-game-mode" class="hidden">
                 <p class="text-center mb-4 text-gray-600">Arraste a defini√ß√£o (Direita) para o termo correto (Esquerda) ou clique em ambos para emparelhar.</p>
                 <div id="fc-game-container" class="grid grid-cols-1 md:grid-cols-2 gap-4 max-w-5xl mx-auto">
                     <!-- Game content generated by JS -->
                 </div>
                 <div id="fc-game-message" class="text-center mt-6 text-xl font-bold text-purple-700 min-h-[2rem]"></div>
                 <div class="text-center mt-4">
                    <button onclick="initMatchGame('flashcards')" class="text-sm underline text-gray-500 hover:text-purple-700">Reiniciar Jogo</button>
                 </div>
            </div>
        </section>

        <!-- SEC√á√ÉO III: GLOSS√ÅRIO -->
        <section id="glossary" class="tab-content hidden fade-in">
             <div class="flex justify-between items-center mb-8">
                <div>
                    <h2 class="text-3xl text-purple-900 classic-font">Gloss√°rio T√©cnico</h2>
                    <p class="text-gray-600">Terminologia essencial da biologia e conserva√ß√£o.</p>
                </div>
                 <div class="flex space-x-2">
                    <button onclick="setGlossaryMode('list')" class="px-4 py-2 bg-purple-600 text-white rounded shadow hover:bg-purple-700 text-sm">Lista</button>
                    <button onclick="setGlossaryMode('game')" class="px-4 py-2 bg-yellow-500 text-white rounded shadow hover:bg-yellow-600 text-sm">Jogo</button>
                </div>
            </div>

            <!-- List Mode -->
            <div id="glossary-list-mode" class="grid grid-cols-1 md:grid-cols-2 gap-6 max-w-6xl mx-auto">
                <!-- Content Injected via JS -->
            </div>

             <!-- Game Mode -->
            <div id="glossary-game-mode" class="hidden">
                <p class="text-center mb-4 text-gray-600">Selecione um termo e a sua defini√ß√£o correspondente.</p>
                <div id="glossary-game-container" class="flex flex-wrap gap-4 justify-center">
                    <!-- Cards injected by JS -->
                </div>
                 <div id="glossary-game-message" class="text-center mt-6 text-xl font-bold text-purple-700 min-h-[2rem]"></div>
                  <div class="text-center mt-4">
                    <button onclick="initMatchGame('glossary')" class="text-sm underline text-gray-500 hover:text-purple-700">Reiniciar Jogo</button>
                 </div>
            </div>
        </section>

        <!-- SEC√á√ÉO IV: APRENDIZAGEM ATIVA (QUIZ) -->
        <section id="quiz" class="tab-content hidden fade-in">
             <div class="max-w-3xl mx-auto">
                <div class="text-center mb-10">
                    <h2 class="text-3xl text-purple-900 classic-font">Question√°rio de Avalia√ß√£o</h2>
                    <p class="text-gray-600 mb-4">Teste os seus conhecimentos para obter o certificado de Jovem Bi√≥logo.</p>
                    
                    <!-- Medals Display -->
                    <div class="flex justify-center gap-4 mb-6">
                        <div id="medal-bronze" class="opacity-30 flex flex-col items-center">
                            <span class="text-3xl">ü•â</span>
                            <span class="text-xs font-bold text-yellow-800">Bronze</span>
                        </div>
                        <div id="medal-silver" class="opacity-30 flex flex-col items-center">
                            <span class="text-3xl">ü•à</span>
                            <span class="text-xs font-bold text-gray-500">Prata</span>
                        </div>
                        <div id="medal-gold" class="opacity-30 flex flex-col items-center">
                            <span class="text-3xl">ü•á</span>
                            <span class="text-xs font-bold text-yellow-500">Ouro</span>
                        </div>
                    </div>
                </div>

                <!-- Start Screen -->
                <div id="quiz-start" class="bg-white p-8 rounded-xl shadow-lg border-t-4 border-purple-600 text-center">
                    <p class="mb-6 text-lg">Este question√°rio cont√©m perguntas de Escolha M√∫ltipla e Verdadeiro/Falso. Ter√° feedback imediato para cada resposta.</p>
                    <button onclick="startQuiz()" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-8 rounded-full text-lg shadow-md transition transform hover:scale-105">
                        Iniciar Desafio
                    </button>
                    <p class="mt-4 text-sm text-gray-400">Pontua√ß√£o m√°xima guardada: <span id="high-score">0</span></p>
                </div>

                <!-- Question Container -->
                <div id="quiz-container" class="hidden">
                    <div class="mb-4 flex justify-between items-center">
                        <span class="text-sm font-bold text-purple-600">Quest√£o <span id="q-current">1</span>/<span id="q-total">15</span></span>
                        <span class="text-sm font-bold text-gray-600">Pontos: <span id="current-score">0</span></span>
                    </div>
                    
                    <div class="bg-white p-6 md:p-8 rounded-xl shadow-md border border-gray-200">
                        <h3 id="question-text" class="text-xl font-bold text-gray-800 mb-6">--</h3>
                        <div id="options-container" class="space-y-3">
                            <!-- Options injected here -->
                        </div>
                    </div>

                    <!-- Feedback Area -->
                    <div id="feedback-area" class="mt-6 hidden p-4 rounded-lg bg-blue-50 border border-blue-200">
                        <h4 id="feedback-title" class="font-bold mb-1">Feedback</h4>
                        <p id="feedback-text" class="text-sm text-blue-800"></p>
                        <button onclick="nextQuestion()" class="mt-4 bg-blue-600 text-white px-6 py-2 rounded shadow hover:bg-blue-700">Pr√≥xima</button>
                    </div>
                </div>

                <!-- Results / Certificate Generation -->
                <div id="quiz-results" class="hidden bg-white p-8 rounded-xl shadow-lg text-center">
                    <h3 class="text-2xl font-bold text-purple-900 mb-4">Quiz Terminado!</h3>
                    <p class="text-lg mb-2">A sua pontua√ß√£o final: <span id="final-score" class="font-bold text-purple-600 text-3xl">0</span></p>
                    <p id="result-message" class="mb-6 text-gray-600 italic">--</p>
                    
                    <div class="border-t pt-6">
                        <label class="block text-left text-sm font-bold text-gray-700 mb-2">Nome para o Certificado:</label>
                        <input type="text" id="student-name" class="w-full p-3 border rounded mb-4 focus:ring-2 focus:ring-purple-500 outline-none" placeholder="Escreve o teu nome aqui...">
                        <div class="flex gap-4 justify-center">
                            <button onclick="generateCertificate()" class="bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-6 rounded shadow-md">
                                üìú Obter Certificado
                            </button>
                            <button onclick="resetQuiz()" class="bg-gray-200 hover:bg-gray-300 text-gray-700 py-2 px-6 rounded">
                                Tentar Novamente
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="bg-white border-t border-gray-200 mt-auto py-6 no-print">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p class="text-gray-500 text-sm">Recurso Educativo - O Alfaiate (Recurvirostra avosetta)</p>
            <p class="text-xs text-gray-400 mt-1">Baseado nos documentos t√©cnicos da Reserva Natural do Estu√°rio do Tejo.</p>
        </div>
    </footer>

    <!-- MODALS -->
    
    <!-- Infographic Modal -->
    <div id="infographic-modal" class="fixed inset-0 bg-black bg-opacity-90 z-50 hidden flex items-center justify-center p-4" onclick="if(event.target === this) closeModal('infographic-modal')">
        <div class="relative w-full h-full flex flex-col">
            <button onclick="closeModal('infographic-modal')" class="absolute top-4 right-4 text-white hover:text-gray-300 text-3xl font-bold z-50">‚úï</button>
            <div class="w-full h-full flex items-center justify-center">
                <!-- Image fitted to screen -->
                <img src="./infografia.jpg" alt="Infografia do Alfaiate" class="max-w-full max-h-full object-contain shadow-2xl" onerror="this.onerror=null; this.src='https://picsum.photos/1200/800?grayscale'; alert('Certifique-se que o ficheiro infografia.jpg existe na pasta raiz.');">
            </div>
        </div>
    </div>

    <!-- Certificate Template (Hidden until Print) -->
    <div id="certificate-area" class="hidden bg-white p-10 text-center border-[20px] border-double border-purple-900 h-screen flex flex-col justify-center items-center bg-[url('https://www.transparenttextures.com/patterns/cream-paper.png')]">
        <h1 class="text-5xl classic-font text-purple-900 mb-8 tracking-widest uppercase">Certificado de M√©rito</h1>
        <p class="text-xl text-gray-600 mb-4">Certifica-se que</p>
        <h2 id="cert-name" class="text-4xl font-bold text-black border-b-2 border-black pb-2 mb-8 px-10 italic font-serif">Nome do Aluno</h2>
        <p class="text-lg text-gray-700 max-w-2xl mx-auto mb-8">
            Concluiu com sucesso o percurso de aprendizagem sobre o <strong>Alfaiate (Recurvirostra avosetta)</strong>, demonstrando conhecimentos sobre a sua biologia, habitat e conserva√ß√£o.
        </p>
        <div class="flex justify-between w-full max-w-2xl mt-10">
            <div class="text-center">
                <div class="w-32 h-32 rounded-full border-4 border-yellow-500 flex items-center justify-center mb-2 mx-auto">
                     <span class="text-4xl">üèÖ</span>
                </div>
                <p class="font-bold text-yellow-600 uppercase tracking-wider">Aprova√ß√£o</p>
            </div>
            <div class="text-right pt-16">
                <div class="border-t border-gray-400 w-48 ml-auto"></div>
                <p class="text-sm text-gray-500 mt-1">Data: <span id="cert-date"></span></p>
            </div>
        </div>
    </div>

    <script>
        // --- DATA OBJECTS --- //

        const studyData = [
            {
                id: "identificacao",
                title: "1. Perfil de Identifica√ß√£o e Taxonomia",
                icon: "üëÅÔ∏è",
                content: `
                    <div class="space-y-3">
                        <p class="font-bold text-purple-800 border-b border-purple-200 pb-1">Classifica√ß√£o</p>
                        <ul class="list-disc pl-5 space-y-1 text-gray-700 text-sm">
                            <li><strong>Ordem:</strong> Charadriiformes (Lim√≠colas).</li>
                            <li><strong>Fam√≠lia:</strong> Recurvirostridae.</li>
                            <li><strong>Nome Cient√≠fico:</strong> <em>Recurvirostra avosetta</em>.</li>
                        </ul>
                        <p class="font-bold text-purple-800 border-b border-purple-200 pb-1 mt-3">Morfologia</p>
                        <ul class="list-disc pl-5 space-y-2 text-gray-700">
                            <li><strong>Apar√™ncia Geral:</strong> "Silhueta de costureira" inconfund√≠vel. Plumagem predominantemente branca com manchas pretas n√≠tidas na coroa (topo da cabe√ßa), nuca e faixas nas asas e dorso.</li>
                            <li><strong>Dimens√µes:</strong> Porte m√©dio-grande para uma lim√≠cola, atingindo 42 a 46 cm de comprimento.</li>
                            <li><strong>Patas:</strong> Longas e cinzento-azuladas, permitindo caminhar em √°guas mais profundas que outras lim√≠colas. P√©s palmados (raro em lim√≠colas), facilitando a nata√ß√£o.</li>
                            <li><strong>Longevidade:</strong> Registo de indiv√≠duos que viveram at√© 28 anos.</li>
                            <li><strong>Dimorfismo Sexual:</strong> Pouco evidente. A f√™mea pode ter o anel branco na base do bico ligeiramente mais largo e o bico por vezes mais curto e curvo, mas a distin√ß√£o em campo √© dif√≠cil.</li>
                        </ul>
                    </div>
                `
            },
            {
                id: "alimentacao",
                title: "2. Alimenta√ß√£o e T√©cnica de Varrimento",
                icon: "ü¶ê",
                content: `
                    <div class="space-y-3">
                        <p class="mb-2 text-gray-800">O bico do Alfaiate √© uma ferramenta evolutiva extraordin√°ria: longo, fino, preto e distintamente <strong>recurvado para cima</strong> na extremidade.</p>
                        
                        <div class="bg-gray-50 p-3 rounded border-l-4 border-blue-400">
                            <h4 class="font-bold text-blue-800 mb-1">A T√©cnica do "Coser"</h4>
                            <p class="text-sm">O m√©todo de alimenta√ß√£o chama-se <strong>varrimento</strong> (scything). A ave caminha na √°gua e move a cabe√ßa lateralmente em arcos de 40 a 60 graus, mantendo a ponta do bico ligeiramente aberta submersa no lodo superficial.</p>
                        </div>

                        <ul class="list-disc pl-5 space-y-2 text-gray-700 mt-2">
                            <li><strong>Sensibilidade:</strong> O bico funciona como √≥rg√£o t√°til, detetando presas ao toque e n√£o pela vis√£o. Isto permite a alimenta√ß√£o <strong>noturna</strong> ou em √°guas turvas.</li>
                            <li><strong>Dieta:</strong> Carn√≠vora. Alimenta-se de pequenos invertebrados aqu√°ticos: larvas de insetos, anel√≠deos (vermes poliquetas), e pequenos crust√°ceos.</li>
                            <li><strong>Artemia:</strong> Nas salinas, consome em grande quantidade a <em>Artemia salina</em>, um pequeno crust√°ceo abundante nestes habitats hipersalinos.</li>
                            <li><strong>Efici√™ncia:</strong> Realiza cerca de 28 movimentos (varrivelas) por minuto.</li>
                        </ul>
                    </div>
                `
            },
            {
                id: "habitat",
                title: "3. Habitat, Distribui√ß√£o e Migra√ß√£o",
                icon: "üåç",
                content: `
                    <div class="space-y-3">
                        <p class="text-gray-700">Ave costeira altamente dependente de <strong>Zonas H√∫midas</strong> de baixa profundidade, preferindo √°guas salobras ou salgadas.</p>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-2">
                            <div class="bg-purple-50 p-3 rounded">
                                <h4 class="font-bold text-purple-700 border-b border-purple-200 pb-1">Em Portugal (Nidifica√ß√£o)</h4>
                                <p class="text-sm mt-2">A popula√ß√£o nidificante √© pequena (algumas centenas de casais). Concentra-se no <strong>Sotavento Algarvio</strong> (Castro Marim, Ria Formosa) e, em menor n√∫mero, nos Estu√°rios do Tejo e Sado. O habitat chave s√£o as <strong>Salinas</strong>.</p>
                            </div>
                            <div class="bg-blue-50 p-3 rounded">
                                <h4 class="font-bold text-blue-700 border-b border-blue-200 pb-1">Em Portugal (Invernada)</h4>
                                <p class="text-sm mt-2">Portugal √© vital para a invernada. Entre <strong>Outubro e Mar√ßo</strong>, recebemos milhares de aves vindas do norte da Europa (Reino Unido, Holanda). O <strong>Estu√°rio do Tejo</strong> acolhe a maior concentra√ß√£o, chegando a representar 15% a 20% da popula√ß√£o invernante da rota do Atl√¢ntico Este.</p>
                            </div>
                        </div>
                        <p class="text-xs text-gray-500 mt-2">Nota: A esp√©cie realiza movimentos dispersivos ap√≥s a reprodu√ß√£o (p√≥s-nupciais) em busca de locais ricos em alimento para a muda da pena.</p>
                    </div>
                `
            },
            {
                id: "reproducao",
                title: "4. Ciclo de Vida e Reprodu√ß√£o",
                icon: "üê£",
                content: `
                    <div class="space-y-3">
                        <ul class="list-disc pl-5 space-y-2 text-gray-700">
                            <li><strong>Colonialismo:</strong> Nidifica em col√≥nias, frequentemente mistas com outras lim√≠colas (como o Pernilongo), o que aumenta a efic√°cia na defesa contra predadores.</li>
                            <li><strong>Ninho:</strong> Simples depress√£o no solo, por vezes forrada com detritos vegetais ou conchas. Localiza-se preferencialmente em ilh√©us ou <strong>c√¥moros de salinas</strong> (diques de terra) para evitar inunda√ß√µes e predadores terrestres.</li>
                            <li><strong>Postura:</strong> Uma √∫nica postura por ano, geralmente em Maio/Junho. P√µe 3 a 4 ovos de cor creme com pintas escuras (camuflagem).</li>
                            <li><strong>Incuba√ß√£o:</strong> Partilhada por ambos os progenitores durante 23 a 25 dias.</li>
                            <li><strong>Crias Nid√≠fugas:</strong> As crias nascem cobertas de penugem e abandonam o ninho horas ap√≥s a eclos√£o. S√£o capazes de se alimentar sozinhas, embora acompanhem os pais at√© ganharem capacidade de voo (35-42 dias).</li>
                        </ul>
                    </div>
                `
            },
            {
                id: "conservacao",
                title: "5. Conserva√ß√£o e Estatuto",
                icon: "üõ°Ô∏è",
                content: `
                    <div class="space-y-3">
                        <p class="mb-2"><strong>Estatuto em Portugal (Livro Vermelho):</strong></p>
                        <ul class="pl-5 text-sm font-mono bg-gray-100 p-2 rounded">
                            <li>Nidificante: <span class="text-yellow-600 font-bold">NT (Quase Amea√ßado)</span></li>
                            <li>Invernante: <span class="text-green-600 font-bold">LC (Pouco Preocupante)</span></li>
                        </ul>
                        
                        <h4 class="font-bold mt-3 text-red-700">Principais Amea√ßas</h4>
                        <ul class="list-disc pl-5 space-y-1 text-gray-700 text-sm">
                            <li><strong>Perda de Habitat:</strong> O abandono da salicultura tradicional leva √† secagem dos tanques ou √† sua convers√£o para aquacultura intensiva, que n√£o oferece condi√ß√µes de nidifica√ß√£o adequadas.</li>
                            <li><strong>Perturba√ß√£o Humana:</strong> Turismo desordenado, mariscadores e c√£es vadios nas zonas de nidifica√ß√£o causam abandono dos ninhos.</li>
                            <li><strong>Preda√ß√£o Natural:</strong> Gaivotas, corvos e raposas atacam ovos e crias.</li>
                            <li><strong>Polui√ß√£o:</strong> Contamina√ß√£o dos lodos estuarinos (metais pesados como Merc√∫rio, Chumbo) afeta a cadeia alimentar.</li>
                        </ul>
                        <div class="mt-4 p-3 bg-yellow-50 border-l-4 border-yellow-500 rounded">
                            <p class="text-sm font-bold text-yellow-800">S√≠mbolo da Conserva√ß√£o</p>
                            <p class="text-xs text-yellow-700">O Alfaiate foi escolhido como s√≠mbolo da <strong>Reserva Natural do Estu√°rio do Tejo (RNET)</strong>, representando a import√¢ncia internacional desta zona h√∫mida.</p>
                        </div>
                    </div>
                `
            },
            {
                id: "curiosidades",
                title: "6. Curiosidades e Comportamento",
                icon: "üí°",
                content: `
                    <div class="space-y-3 text-gray-700">
                        <p><strong>Estrat√©gia da "Asa Partida":</strong></p>
                        <p class="text-sm ml-4 border-l-2 border-purple-200 pl-2">Quando um predador se aproxima do ninho, os adultos simulam estar feridos, arrastando uma asa no ch√£o para atrair a aten√ß√£o do predador e afast√°-lo dos ovos ou crias. Quando o predador est√° longe o suficiente, a ave levanta voo repentinamente.</p>
                        
                        <p class="mt-2"><strong>Agressividade:</strong></p>
                        <p class="text-sm ml-4 border-l-2 border-purple-200 pl-2">Apesar da apar√™ncia elegante, s√£o extremamente agressivos na defesa da col√≥nia, bombardeando em voo (dive-bombing) intrusos muito maiores, incluindo gar√ßas e tartaranh√µes.</p>
                        
                        <p class="mt-2"><strong>Nata√ß√£o:</strong></p>
                        <p class="text-sm ml-4 border-l-2 border-purple-200 pl-2">Ao contr√°rio de muitas lim√≠colas que apenas caminham, o Alfaiate nada muito bem gra√ßas √†s membranas interdigitais (patas palmadas), parecendo um pequeno pato branco.</p>
                    </div>
                `
            }
        ];

        const flashcardData = [
            { q: "Nome cient√≠fico do Alfaiate?", a: "Recurvirostra avosetta" },
            { q: "Fam√≠lia taxon√≥mica?", a: "Recurvirostridae" },
            { q: "Comprimento m√°ximo?", a: "46 cm" },
            { q: "Longevidade m√°xima?", a: "28 anos" },
            { q: "Forma do bico?", a: "Longo e recurvado para cima" },
            { q: "Movimento de alimenta√ß√£o?", a: "Varredura (varrimento lateral)" },
            { q: "Dieta principal?", a: "Insetos, crust√°ceos, vermes" },
            { q: "Sentido usado na ca√ßa?", a: "Tato (bico sens√≠vel)" },
            { q: "Estatuto Nidificante (PT)?", a: "Quase Amea√ßado (NT)" },
            { q: "Estatuto Invernante (PT)?", a: "Pouco Preocupante (LC)" },
            { q: "S√≠mbolo de qual √°rea?", a: "R. N. Estu√°rio do Tejo" },
            { q: "Regi√£o principal de nidifica√ß√£o?", a: "Algarve (Sotavento)" },
            { q: "Locais de invernada?", a: "Estu√°rios do Tejo e Sado" },
            { q: "Meses de observa√ß√£o (pico)?", a: "Outubro a Mar√ßo" },
            { q: "Habitat de nidifica√ß√£o?", a: "Salinas (c√¥moros)" },
            { q: "Crias s√£o...?", a: "Nid√≠fugas (precoces)" },
            { q: "N¬∫ de ovos por postura?", a: "3 ou 4" },
            { q: "Tempo de incuba√ß√£o?", a: "23 a 25 dias" },
            { q: "Socializa√ß√£o?", a: "Esp√©cie colonial" },
            { q: "Amea√ßa de habitat?", a: "Abandono de salinas" },
            { q: "Poluente no Tejo?", a: "Merc√∫rio" },
            { q: "Tipo de bico (rigidez)?", a: "Flex√≠vel (como borracha)" },
            { q: "Atividade alimentar (hor√°rio)?", a: "Dia e Noite" },
            { q: "Varrivelas por minuto?", a: "Aprox. 28" },
            { q: "Substrato preferido?", a: "Sedimentos brandos (lodos)" },
            { q: "V√≠nculo do casal?", a: "Monog√¢mico sazonal" },
            { q: "Defesa de ninho?", a: "Simula√ß√£o de asa partida" },
            { q: "Significado de Nid√≠fugo?", a: "Abandona ninho ap√≥s nascer" },
            { q: "Regi√£o Biogeogr√°fica?", a: "Pale√°rctico" },
            { q: "Patas especiais?", a: "Palmadas (membranas)" }
        ];

        const glossaryData = [
            { term: "C√¥moros", def: "Diques de terra que separam tanques nas salinas; local de nidifica√ß√£o." },
            { term: "Estu√°rio", def: "Zona onde o rio encontra o mar, rica em nutrientes e sedimentos." },
            { term: "Invernante", def: "Popula√ß√£o que usa uma regi√£o para passar o inverno." },
            { term: "Lim√≠cola", def: "Ave que vive em zonas de lodo ou areia (zonas h√∫midas)." },
            { term: "Nid√≠fugo", def: "Crias que abandonam o ninho logo ap√≥s a eclos√£o." },
            { term: "Pale√°rctico", def: "Regi√£o biogeogr√°fica que inclui Europa, N. √Åfrica e √Åsia." },
            { term: "Poliquetas", def: "Vermes marinhos que servem de alimento." },
            { term: "Salinas", def: "Habitat artificial de produ√ß√£o de sal, vital para o Alfaiate." },
            { term: "Varrivelas", def: "Movimentos laterais r√°pidos do bico para capturar alimento." },
            { term: "ZPE", def: "Zona de Prote√ß√£o Especial (Diretiva Aves)." },
            { term: "Dimorfismo", def: "Diferen√ßa visual entre macho e f√™mea da mesma esp√©cie." },
            { term: "Col√≥nia", def: "Grupo de aves que nidificam pr√≥ximas umas das outras." }
        ];

        const quizData = [
            {
                q: "Qual √© a principal caracter√≠stica do bico do Alfaiate?",
                options: ["Curto e grosso", "Longo e recurvado para cima", "Direito e vermelho", "Largo como uma colher"],
                correct: 1,
                feedback: "Correto! O bico √© recurvado para cima, adaptado para varrer o lodo."
            },
            {
                q: "O Alfaiate √© o s√≠mbolo de que √Årea Protegida?",
                options: ["Ria Formosa", "Estu√°rio do Sado", "Estu√°rio do Tejo", "Peneda-Ger√™s"],
                correct: 2,
                feedback: "Exato! √â o s√≠mbolo da Reserva Natural do Estu√°rio do Tejo desde a sua cria√ß√£o."
            },
            {
                q: "As crias de Alfaiate s√£o nid√≠fugas. O que significa?",
                options: ["Nascem cegas", "Ficam no ninho 2 meses", "Abandonam o ninho logo ap√≥s nascer", "S√£o alimentadas bico-a-bico"],
                correct: 2,
                feedback: "Certo! Elas nascem desenvolvidas e procuram o seu pr√≥prio alimento imediatamente."
            },
            {
                q: "Qual √© a t√©cnica de alimenta√ß√£o utilizada?",
                options: ["Mergulho profundo", "Picagem vertical", "Varredura lateral", "Captura em voo"],
                correct: 2,
                feedback: "Isso mesmo! Faz um movimento de 'ceifar' ou 'coser' lateralmente."
            },
            {
                q: "(V/F) O Alfaiate alimenta-se apenas durante o dia.",
                options: ["Verdadeiro", "Falso"],
                correct: 1,
                feedback: "Falso! Gra√ßas ao tato sens√≠vel do bico, pode alimentar-se eficazmente √† noite."
            },
            {
                q: "Onde √© que o Alfaiate prefere fazer o ninho?",
                options: ["Em √°rvores", "Em rochas", "Nos c√¥moros das salinas", "Flutuando na √°gua"],
                correct: 2,
                feedback: "Correto! Usa os diques de terra (c√¥moros) entre os tanques das salinas."
            },
            {
                q: "Qual o estatuto de conserva√ß√£o da popula√ß√£o nidificante em Portugal?",
                options: ["Pouco Preocupante", "Quase Amea√ßado", "Em Perigo", "Extinto"],
                correct: 1,
                feedback: "Sim, √© Quase Amea√ßado (NT) devido ao n√∫mero reduzido de casais reprodutores."
            },
            {
                q: "Qual destas √© uma amea√ßa √† esp√©cie?",
                options: ["Constru√ß√£o de ninhos", "Abandono de salinas", "Excesso de peixe", "Migra√ß√£o"],
                correct: 1,
                feedback: "Correto. O abandono das salinas tradicionais destr√≥i o seu habitat preferencial."
            },
            {
                q: "O que come principalmente o Alfaiate?",
                options: ["Peixes grandes", "Algas", "Invertebrados (insetos/vermes)", "Sementes"],
                correct: 2,
                feedback: "Certo! √â uma ave carn√≠vora especializada em pequenos invertebrados."
            },
            {
                q: "(V/F) O bico do Alfaiate √© r√≠gido como osso.",
                options: ["Verdadeiro", "Falso"],
                correct: 1,
                feedback: "Falso! √â flex√≠vel e sens√≠vel, comparado frequentemente a borracha."
            },
            {
                q: "Que comportamento usa o Alfaiate para afastar predadores do ninho?",
                options: ["Canta melodiosamente", "Simula ter uma asa partida", "Esconde-se na areia", "Cospe veneno"],
                correct: 1,
                feedback: "Correto! Finge estar ferido para atrair a aten√ß√£o do predador para longe das crias."
            },
            {
                q: "Em que √©poca do ano ocorrem as maiores concentra√ß√µes em Portugal?",
                options: ["Ver√£o (Junho-Agosto)", "Inverno (Outubro-Mar√ßo)", "Apenas em Janeiro", "Todo o ano igual"],
                correct: 1,
                feedback: "Certo! Portugal recebe milhares de aves invernantes do norte da Europa."
            },
            {
                q: "Qual destas adapta√ß√µes √© rara em lim√≠colas mas presente no Alfaiate?",
                options: ["Bico longo", "P√©s palmados", "Penas brancas", "Voar"],
                correct: 1,
                feedback: "Muito bem! Os p√©s palmados permitem-lhe nadar, algo incomum em aves de lodo."
            },
            {
                q: "Qual √© o principal crust√°ceo das salinas que serve de alimento?",
                options: ["Lagosta", "Caranguejo-violinista", "Artemia", "Camar√£o-tigre"],
                correct: 2,
                feedback: "Correto! A Artemia salina √© uma fonte de alimento fundamental nestes habitats."
            },
            {
                q: "(V/F) Os Alfaiates s√£o aves solit√°rias que evitam outras esp√©cies.",
                options: ["Verdadeiro", "Falso"],
                correct: 1,
                feedback: "Falso! S√£o coloniais e muitas vezes nidificam junto de pernilongos e andorinhas-do-mar."
            }
        ];

        // --- STATE MANAGEMENT --- //
        
        let state = {
            currentTab: 'study',
            flashcardIndex: 0,
            quizScore: 0,
            currentQuestion: 0,
            highScore: parseInt(localStorage.getItem('alfaiate_highscore')) || 0
        };

        // --- INITIALIZATION --- //

        document.addEventListener('DOMContentLoaded', () => {
            renderStudyContent();
            renderGlossaryList();
            renderFlashcard();
            loadProgress();
            
            // Check medals
            updateMedals(state.highScore);
            document.getElementById('high-score').textContent = state.highScore;
        });

        // --- NAVIGATION --- //

        function switchTab(tabId) {
            // Update State
            state.currentTab = tabId;
            saveProgress();

            // Hide all sections
            document.querySelectorAll('.tab-content').forEach(el => {
                el.classList.add('hidden');
            });
            
            // Show target section
            document.getElementById(tabId).classList.remove('hidden');

            // Update Desktop Nav
            document.querySelectorAll('.nav-btn').forEach(btn => {
                if(btn.dataset.tab === tabId) {
                    btn.classList.add('bg-purple-800', 'text-white', 'shadow-inner');
                    btn.classList.remove('text-purple-100');
                } else {
                    btn.classList.remove('bg-purple-800', 'text-white', 'shadow-inner');
                    btn.classList.add('text-purple-100');
                }
            });

            // Update Progress Bar visuals
            const progressMap = { 'study': '25%', 'flashcards': '50%', 'glossary': '75%', 'quiz': '100%' };
            document.getElementById('progress-bar').style.width = progressMap[tabId];
            
            // Close mobile menu if open
            document.getElementById('mobile-menu').classList.add('hidden');

            window.scrollTo(0,0);
        }

        function toggleMobileMenu() {
            document.getElementById('mobile-menu').classList.toggle('hidden');
        }

        function openModal(id) { document.getElementById(id).classList.remove('hidden'); }
        function closeModal(id) { document.getElementById(id).classList.add('hidden'); }

        // --- PERSISTENCE --- //
        function saveProgress() {
            localStorage.setItem('alfaiate_tab', state.currentTab);
        }

        function loadProgress() {
            const savedTab = localStorage.getItem('alfaiate_tab');
            if(savedTab) switchTab(savedTab);
            else switchTab('study');
        }

        // --- RENDERERS --- //

        // 1. Study Guide
        function renderStudyContent() {
            const container = document.getElementById('study-content');
            container.innerHTML = studyData.map(item => `
                <div class="bg-white rounded-lg shadow border-l-4 border-purple-400 overflow-hidden">
                    <button class="w-full text-left px-6 py-4 flex justify-between items-center focus:outline-none bg-gray-50 hover:bg-gray-100 transition" onclick="toggleAccordion('${item.id}')">
                        <span class="font-bold text-lg text-purple-900 flex items-center gap-3">
                            <span class="text-2xl">${item.icon}</span> ${item.title}
                        </span>
                        <svg id="icon-${item.id}" class="w-5 h-5 text-purple-500 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </button>
                    <div id="content-${item.id}" class="hidden px-6 py-4 border-t border-gray-100 text-gray-700 leading-relaxed">
                        ${item.content}
                    </div>
                </div>
            `).join('');
        }

        function toggleAccordion(id) {
            const content = document.getElementById(`content-${id}`);
            const icon = document.getElementById(`icon-${id}`);
            content.classList.toggle('hidden');
            icon.classList.toggle('rotate-180');
        }

        // 2. Flashcards
        function setFlashcardMode(mode) {
            const viewMode = document.getElementById('fc-view-mode');
            const gameMode = document.getElementById('fc-game-mode');
            
            if(mode === 'view') {
                viewMode.classList.remove('hidden');
                gameMode.classList.add('hidden');
            } else {
                viewMode.classList.add('hidden');
                gameMode.classList.remove('hidden');
                initMatchGame('flashcards');
            }
        }

        function renderFlashcard() {
            const card = flashcardData[state.flashcardIndex];
            document.getElementById('fc-front').textContent = card.q;
            document.getElementById('fc-back').textContent = card.a;
            document.getElementById('fc-counter').textContent = `${state.flashcardIndex + 1} / ${flashcardData.length}`;
            
            // Ensure card starts facing front
            const el = document.getElementById('current-flashcard');
            if(el.classList.contains('rotate-y-180')) el.classList.remove('rotate-y-180');
        }

        function flipCard(el) {
            el.firstElementChild.classList.toggle('rotate-y-180');
        }

        function nextCard() {
            if(state.flashcardIndex < flashcardData.length - 1) {
                state.flashcardIndex++;
                renderFlashcard();
            }
        }

        function prevCard() {
            if(state.flashcardIndex > 0) {
                state.flashcardIndex--;
                renderFlashcard();
            }
        }

        // 3. Glossary
        function setGlossaryMode(mode) {
            const listMode = document.getElementById('glossary-list-mode');
            const gameMode = document.getElementById('glossary-game-mode');
            
            if(mode === 'list') {
                listMode.classList.remove('hidden');
                gameMode.classList.add('hidden');
            } else {
                listMode.classList.add('hidden');
                gameMode.classList.remove('hidden');
                initMatchGame('glossary');
            }
        }

        function renderGlossaryList() {
            const container = document.getElementById('glossary-list-mode');
            container.innerHTML = glossaryData.map(item => `
                <div class="bg-white p-4 rounded-lg shadow-sm border border-purple-100 hover:shadow-md transition">
                    <h4 class="font-bold text-purple-700 text-lg mb-1">${item.term}</h4>
                    <p class="text-gray-600 text-sm">${item.def}</p>
                </div>
            `).join('');
        }

        // --- GAME LOGIC (MATCHING) --- //
        
        let selectedGameItem = null;
        let gamePairs = [];
        let gameMatchedCount = 0;

        function initMatchGame(type) {
            const container = type === 'flashcards' ? document.getElementById('fc-game-container') : document.getElementById('glossary-game-container');
            const messageEl = type === 'flashcards' ? document.getElementById('fc-game-message') : document.getElementById('glossary-game-message');
            
            container.innerHTML = '';
            messageEl.textContent = '';
            messageEl.className = 'text-center mt-6 text-xl font-bold text-purple-700 min-h-[2rem]';
            selectedGameItem = null;
            gameMatchedCount = 0;

            // Select 6 random items
            const source = type === 'flashcards' ? flashcardData : glossaryData;
            const items = [...source].sort(() => 0.5 - Math.random()).slice(0, 6);
            gamePairs = items.length;

            // Create arrays for Questions (Left) and Answers (Right) or just mixed for glossary
            let inputs = [];
            
            items.forEach((item, index) => {
                const qKey = type === 'flashcards' ? item.q : item.term;
                const aKey = type === 'flashcards' ? item.a : item.def;

                inputs.push({ id: `q-${index}`, text: qKey, type: 'q', matchId: index });
                inputs.push({ id: `a-${index}`, text: aKey, type: 'a', matchId: index });
            });

            // Shuffle display
            inputs.sort(() => 0.5 - Math.random());

            inputs.forEach(item => {
                const btn = document.createElement('button');
                btn.className = `p-4 bg-white border-2 border-purple-200 rounded shadow hover:bg-purple-50 transition text-sm text-center flex items-center justify-center min-h-[80px] w-full select-none`;
                btn.textContent = item.text;
                btn.dataset.id = item.id;
                btn.dataset.matchId = item.matchId;
                btn.dataset.type = item.type;
                
                btn.onclick = () => handleGameClick(btn, type, items.length);
                container.appendChild(btn);
            });
            
            // For flashcards, enforce grid structure slightly better if possible, but random mix is harder/fun
            if(type === 'flashcards') {
                container.className = "grid grid-cols-2 md:grid-cols-4 gap-4 max-w-5xl mx-auto";
            }
        }

        function handleGameClick(el, type, totalPairs) {
            if(el.classList.contains('bg-green-100')) return; // Already matched
            const messageEl = type === 'flashcards' ? document.getElementById('fc-game-message') : document.getElementById('glossary-game-message');

            // Select
            if(!selectedGameItem) {
                selectedGameItem = el;
                el.classList.add('border-purple-600', 'bg-purple-100');
                return;
            }

            // Deselect if same clicked
            if(selectedGameItem === el) {
                selectedGameItem = null;
                el.classList.remove('border-purple-600', 'bg-purple-100');
                return;
            }

            // Check Match
            if(selectedGameItem.dataset.matchId === el.dataset.matchId) {
                // Match!
                selectedGameItem.classList.remove('border-purple-600', 'bg-purple-100');
                selectedGameItem.classList.add('bg-green-100', 'border-green-500', 'opacity-50', 'cursor-default');
                el.classList.add('bg-green-100', 'border-green-500', 'opacity-50', 'cursor-default');
                
                selectedGameItem = null;
                gameMatchedCount++;
                messageEl.textContent = "Correto! üéâ";
                messageEl.className = "text-center mt-6 text-xl font-bold text-green-600 animate-pulse";

                if(gameMatchedCount === totalPairs) {
                    messageEl.textContent = "Parab√©ns! Completaste o desafio! üèÜ";
                }
            } else {
                // Fail
                el.classList.add('bg-red-100', 'border-red-500');
                selectedGameItem.classList.add('bg-red-100', 'border-red-500');
                messageEl.textContent = "Tenta outra vez...";
                messageEl.className = "text-center mt-6 text-xl font-bold text-red-600";
                
                const temp1 = selectedGameItem;
                const temp2 = el;
                selectedGameItem = null;

                setTimeout(() => {
                    temp1.classList.remove('bg-red-100', 'border-red-500', 'bg-purple-100', 'border-purple-600');
                    temp2.classList.remove('bg-red-100', 'border-red-500');
                    messageEl.textContent = "";
                }, 1000);
            }
        }

        // --- QUIZ LOGIC --- //

        function startQuiz() {
            state.quizScore = 0;
            state.currentQuestion = 0;
            document.getElementById('quiz-start').classList.add('hidden');
            document.getElementById('quiz-container').classList.remove('hidden');
            document.getElementById('quiz-results').classList.add('hidden');
            loadQuestion();
        }

        function loadQuestion() {
            const q = quizData[state.currentQuestion];
            document.getElementById('q-current').textContent = state.currentQuestion + 1;
            document.getElementById('q-total').textContent = quizData.length;
            document.getElementById('current-score').textContent = state.quizScore;
            
            document.getElementById('question-text').textContent = q.q;
            
            const optsContainer = document.getElementById('options-container');
            optsContainer.innerHTML = '';
            
            q.options.forEach((opt, idx) => {
                const btn = document.createElement('button');
                btn.className = "w-full text-left p-4 rounded border border-gray-200 hover:bg-purple-50 hover:border-purple-300 transition flex items-center gap-3";
                btn.innerHTML = `<span class="bg-gray-200 text-gray-700 w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold">${String.fromCharCode(65+idx)}</span> ${opt}`;
                btn.onclick = () => handleAnswer(idx, btn);
                optsContainer.appendChild(btn);
            });

            document.getElementById('feedback-area').classList.add('hidden');
        }

        function handleAnswer(selectedIndex, btnElement) {
            const q = quizData[state.currentQuestion];
            const feedbackArea = document.getElementById('feedback-area');
            const feedbackText = document.getElementById('feedback-text');
            const feedbackTitle = document.getElementById('feedback-title');
            
            // Disable all buttons
            const buttons = document.getElementById('options-container').querySelectorAll('button');
            buttons.forEach(b => b.disabled = true);

            if(selectedIndex === q.correct) {
                state.quizScore += 10;
                document.getElementById('current-score').textContent = state.quizScore;
                btnElement.classList.add('bg-green-100', 'border-green-500');
                feedbackArea.className = "mt-6 p-4 rounded-lg bg-green-50 border border-green-200 fade-in";
                feedbackTitle.textContent = "Correto! ‚úÖ";
                feedbackTitle.className = "font-bold mb-1 text-green-800";
                feedbackText.className = "text-sm text-green-800";
            } else {
                btnElement.classList.add('bg-red-100', 'border-red-500');
                // Highlight correct one
                buttons[q.correct].classList.add('bg-green-50', 'border-green-300');
                feedbackArea.className = "mt-6 p-4 rounded-lg bg-red-50 border border-red-200 fade-in";
                feedbackTitle.textContent = "Incorreto ‚ùå";
                feedbackTitle.className = "font-bold mb-1 text-red-800";
                feedbackText.className = "text-sm text-red-800";
            }

            feedbackText.textContent = q.feedback;
            feedbackArea.classList.remove('hidden');
        }

        function nextQuestion() {
            state.currentQuestion++;
            if(state.currentQuestion < quizData.length) {
                loadQuestion();
            } else {
                finishQuiz();
            }
        }

        function finishQuiz() {
            document.getElementById('quiz-container').classList.add('hidden');
            document.getElementById('quiz-results').classList.remove('hidden');
            
            const finalScore = state.quizScore;
            document.getElementById('final-score').textContent = finalScore;
            
            // Update High Score
            if(finalScore > state.highScore) {
                state.highScore = finalScore;
                localStorage.setItem('alfaiate_highscore', state.highScore);
                updateMedals(finalScore);
            }

            // Message
            const msgEl = document.getElementById('result-message');
            const maxScore = quizData.length * 10;
            const percentage = (finalScore / maxScore) * 100;

            if(percentage === 100) msgEl.textContent = "Perfeito! √âs um verdadeiro especialista no Alfaiate!";
            else if(percentage >= 70) msgEl.textContent = "Excelente trabalho! Conheces muito bem esta esp√©cie.";
            else if(percentage >= 50) msgEl.textContent = "Bom esfor√ßo! Continua a estudar os flashcards.";
            else msgEl.textContent = "N√£o desanimes. Rev√™ o Guia de Estudo e tenta novamente!";
        }

        function resetQuiz() {
            document.getElementById('quiz-results').classList.add('hidden');
            document.getElementById('quiz-start').classList.remove('hidden');
        }

        function updateMedals(score) {
            const bronze = document.getElementById('medal-bronze');
            const silver = document.getElementById('medal-silver');
            const gold = document.getElementById('medal-gold');
            
            // Adjusted logic for 15 questions (max 150 points)
            // Bronze > 50 (33%), Silver > 100 (66%), Gold > 130 (86%)
            if(score >= 50) bronze.classList.remove('opacity-30');
            if(score >= 100) silver.classList.remove('opacity-30');
            if(score >= 130) gold.classList.remove('opacity-30');
        }

        function generateCertificate() {
            const name = document.getElementById('student-name').value;
            if(!name) {
                alert("Por favor, introduz o teu nome.");
                return;
            }
            
            document.getElementById('cert-name').textContent = name;
            
            const now = new Date();
            document.getElementById('cert-date').textContent = now.toLocaleDateString('pt-PT');
            
            window.print();
        }

    </script>
</body>
</html>